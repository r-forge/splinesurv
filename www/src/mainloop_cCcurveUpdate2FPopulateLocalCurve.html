<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
 
<meta http-equiv="Content-Style-Type" content="text/css" />
<meta http-equiv="Content-type" content="text/html; charset=ISO-8859-1" />
<link rel="stylesheet" href="../robodoc.css" type="text/css" />
<title>./splinesurv/src/mainloop.c</title>
<!-- Source: ./splinesurv/src/mainloop.c -->
<!-- Generated with ROBODoc Version 4.99.36 (Jun 17 2008) -->
</head>
<body>
<div id="logo">

<a name="robo_top_of_doc" href="http://splinesurv.r-forge.r-project.org/">splinesurv</a>
</div> <!-- logo -->
<div id="navigation">
<a class="menuitem" href="./mainloop_cCFitting2FCcurveUpdate.html#robo7">CcurveUpdate</a><a class="menuitem" href="../robo_functions.html#robo_top_of_doc">Functions</a></div> <!-- navigation -->
<div id="content">
<h3>TABLE OF CONTENTS</h3>
<ul>
<li>1. <a href="#robo36">CcurveUpdate/PopulateLocalCurve</a></li>
</ul>
<hr />
<a name="CcurveUpdate2fPopulateLocalCurve"></a>
<a name="robo36"></a><h2>CcurveUpdate/PopulateLocalCurve [ Functions ]</h2>

<p class="item_name">NAME</p>
<pre>    <strong>PopulateLocalCurve</strong> --- populate a <a href="./mainloop_c01structures2FCCurve.html#robo23">CCurve</a> structure from an <a href="../R/splinefrailty_r01structures2FRCurve.html#robo26">RCurve</a>
</pre>
<p class="item_name">FUNCTION</p>
<p>    At initialization of the <a href="./mainloop_c00main2FSplineSurvMainLoop.html#robo22">SplineSurvMainLoop</a>, this routine populates a local
    curve that is easier to work with in C. Much of this just consists of 
    creating a set of pointers that point to the appropriate locations in R memory.
</p>
<p class="item_name">SYNOPSIS</p>
<pre class="source"><span class="line_number">697 </span><span class="keyword">void</span> <strong>PopulateLocalCurve</strong><span class="sign">(</span> curveP theCurve<span class="sign">,</span> SEXP Rcurve<span class="sign">)</span>
</pre>
<p class="item_name">INPUTS</p>
<pre>    theCurve  a <a href="./mainloop_c01structures2FCCurve.html#robo23">CCurve</a> to be populated
    Rcurve    the <a href="../R/splinefrailty_r01structures2FRCurve.html#robo26">RCurve</a> that contains the current values
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><span class="line_number">701 </span><span class="sign">{</span>
<span class="line_number">702 </span>    <span class="comment">// has a parametric component?</span>
<span class="line_number">703 </span>    theCurve<span class="sign">-</span><span class="sign">&gt;</span>hasPar <span class="sign">=</span> asInteger<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"<a href="../R/splinefrailty_rmiscUtils2Fhaspar.html#robo154">haspar</a>"</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">704 </span>    <span class="comment">// has a spline component?</span>
<span class="line_number">705 </span>    theCurve<span class="sign">-</span><span class="sign">&gt;</span>hasSpline <span class="sign">=</span> asInteger<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"<a href="../R/splinefrailty_rmiscUtils2Fhasspline.html#robo155">hasspline</a>"</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">706 </span>    <span class="comment">// does it use adaptive knot selection?</span>
<span class="line_number">707 </span>    theCurve<span class="sign">-</span><span class="sign">&gt;</span>SplineAdaptive <span class="sign">=</span> asInteger<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"spline.adaptive"</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">708 </span>    <span class="comment">// length of observations (times/frailties)</span>
<span class="line_number">709 </span>    theCurve<span class="sign">-</span><span class="sign">&gt;</span>nx <span class="sign">=</span> <span class="sign">(</span><span class="keyword">int</span><span class="sign">)</span> <span class="sign">(</span><span class="keyword">length</span><span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"x"</span><span class="sign">)</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">710 </span>    <span class="comment">// minimum spline parameter value</span>
<span class="line_number">711 </span>    theCurve<span class="sign">-</span><span class="sign">&gt;</span>SplineMin <span class="sign">=</span> REAL<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"spline.min"</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">712 </span>    <span class="comment">// spline prior varianc3</span>
<span class="line_number">713 </span>    theCurve<span class="sign">-</span><span class="sign">&gt;</span>SplinePriorvar <span class="sign">=</span>  REAL<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"spline.priorvar"</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">714 </span>    <span class="comment">// spline hyperparameters</span>
<span class="line_number">715 </span>    theCurve<span class="sign">-</span><span class="sign">&gt;</span>SplineHyper <span class="sign">=</span>  REAL<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"spline.hyper"</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">716 </span>    <span class="comment">// spline tuning parameters</span>
<span class="line_number">717 </span>    theCurve<span class="sign">-</span><span class="sign">&gt;</span>SplineTun <span class="sign">=</span>  REAL<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"spline.tun"</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">718 </span>    <span class="comment">// spline accept/reject of the last step</span>
<span class="line_number">719 </span>    theCurve<span class="sign">-</span><span class="sign">&gt;</span>SplineAccept <span class="sign">=</span>  REAL<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"spline.accept"</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">720 </span>    <span class="comment">// parameter prior variance</span>
<span class="line_number">721 </span>    theCurve<span class="sign">-</span><span class="sign">&gt;</span>ParamPriorvar <span class="sign">=</span> REAL<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"param.priorvar"</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">722 </span>    <span class="comment">// parametric tuning parameter</span>
<span class="line_number">723 </span>    theCurve<span class="sign">-</span><span class="sign">&gt;</span>ParamTun <span class="sign">=</span> REAL<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"param.tun"</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">724 </span>    <span class="comment">// parametric hyperparameters</span>
<span class="line_number">725 </span>    theCurve<span class="sign">-</span><span class="sign">&gt;</span>ParamHyper <span class="sign">=</span> REAL<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"param.hyper"</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">726 </span>    <span class="comment">// parametric accept/reject of last step</span>
<span class="line_number">727 </span>    theCurve<span class="sign">-</span><span class="sign">&gt;</span>ParamAccept <span class="sign">=</span> REAL<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"param.accept"</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">728 </span>    <span class="comment">// weight of spline component</span>
<span class="line_number">729 </span>    theCurve<span class="sign">-</span><span class="sign">&gt;</span>Weight <span class="sign">=</span> REAL<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"weight"</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">730 </span>    <span class="comment">// prior variance of weight</span>
<span class="line_number">731 </span>    theCurve<span class="sign">-</span><span class="sign">&gt;</span>WeightPriorvar <span class="sign">=</span> REAL<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"weight.priorvar"</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">732 </span>    <span class="comment">// hyperparameters of weight</span>
<span class="line_number">733 </span>    theCurve<span class="sign">-</span><span class="sign">&gt;</span>WeightHyper <span class="sign">=</span> REAL<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"weight.hyper"</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">734 </span>    <span class="comment">// tuning parameter of weight</span>
<span class="line_number">735 </span>    theCurve<span class="sign">-</span><span class="sign">&gt;</span>WeightTun <span class="sign">=</span> REAL<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"weight.tun"</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">736 </span>    <span class="comment">// accept/reject for last step of weight</span>
<span class="line_number">737 </span>    theCurve<span class="sign">-</span><span class="sign">&gt;</span>WeightAccept <span class="sign">=</span> REAL<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"weight.accept"</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">738 </span>    <span class="comment">// vector of observations</span>
<span class="line_number">739 </span>    theCurve<span class="sign">-</span><span class="sign">&gt;</span>X <span class="sign">=</span> REAL<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"x"</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">740 </span>    <span class="comment">// vector of the curve evaluated at X</span>
<span class="line_number">741 </span>    theCurve<span class="sign">-</span><span class="sign">&gt;</span>Y <span class="sign">=</span> REAL<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"y"</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">742 </span>    <span class="comment">// hazard curves also need a vector of cumulative hazard integrals</span>
<span class="line_number">743 </span>    <span class="keyword">if</span><span class="sign">(</span>theCurve<span class="sign">-</span><span class="sign">&gt;</span>isHazard<span class="sign">)</span> theCurve<span class="sign">-</span><span class="sign">&gt;</span>Ycum <span class="sign">=</span>REAL<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"ycum"</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">744 </span>    <span class="comment">// frailty curve needs to keep track of acceptance of the frailties themselves</span>
<span class="line_number">745 </span>    <span class="keyword">if</span><span class="sign">(</span><span class="sign">!</span>theCurve<span class="sign">-</span><span class="sign">&gt;</span>isHazard<span class="sign">)</span> theCurve<span class="sign">-</span><span class="sign">&gt;</span>Accept <span class="sign">=</span>REAL<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"accept"</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">746 </span>    <span class="comment">// tuning parameter for the frailties</span>
<span class="line_number">747 </span>    <span class="keyword">if</span><span class="sign">(</span><span class="sign">!</span>theCurve<span class="sign">-</span><span class="sign">&gt;</span>isHazard<span class="sign">)</span> theCurve<span class="sign">-</span><span class="sign">&gt;</span>tun <span class="sign">=</span> REAL<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"tun"</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">748 </span>
<span class="line_number">749 </span>    <span class="comment">// special terms for spline components</span>
<span class="line_number">750 </span>    <span class="keyword">if</span><span class="sign">(</span>theCurve<span class="sign">-</span><span class="sign">&gt;</span>hasSpline<span class="sign">)</span><span class="sign">{</span>  
<span class="line_number">751 </span>        <span class="comment">// order of the spline</span>
<span class="line_number">752 </span>        theCurve<span class="sign">-</span><span class="sign">&gt;</span>SplineOrd<span class="sign">=</span>asInteger<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"spline.ord"</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">753 </span>        <span class="comment">// number of knots of the spline</span>
<span class="line_number">754 </span>        theCurve<span class="sign">-</span><span class="sign">&gt;</span>SplineNknots <span class="sign">=</span> asInteger<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"spline.nknots"</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">755 </span>        <span class="comment">// max number of knots</span>
<span class="line_number">756 </span>        theCurve<span class="sign">-</span><span class="sign">&gt;</span>SplineNknotsMax <span class="sign">=</span> asInteger<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"spline.maxoccknots"</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">757 </span>        <span class="comment">// hyperparameters for the number of knots</span>
<span class="line_number">758 </span>        theCurve<span class="sign">-</span><span class="sign">&gt;</span>SplineNknotsHyper <span class="sign">=</span> REAL<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"spline.nknots.hyper"</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">759 </span>        <span class="comment">// number of candidate knots</span>
<span class="line_number">760 </span>        theCurve<span class="sign">-</span><span class="sign">&gt;</span>SplineNCandKnots <span class="sign">=</span> asInteger<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"spline.ncandknots"</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">761 </span>        <span class="comment">// vector of candidate knot positions</span>
<span class="line_number">762 </span>        theCurve<span class="sign">-</span><span class="sign">&gt;</span>SplineCandKnots <span class="sign">=</span> REAL<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"spline.candknots"</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">763 </span>        <span class="comment">// vector of occupancies of candidate knots</span>
<span class="line_number">764 </span>        theCurve<span class="sign">-</span><span class="sign">&gt;</span>SplineCandOcc <span class="sign">=</span> REAL<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"spline.candocc"</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">765 </span>        <span class="comment">// constant used for birth-death-move step</span>
<span class="line_number">766 </span>        theCurve<span class="sign">-</span><span class="sign">&gt;</span>SplineBDMConst <span class="sign">=</span> REAL<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"spline.bdmconst"</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">767 </span>        <span class="comment">// number of spline basis functions</span>
<span class="line_number">768 </span>        theCurve<span class="sign">-</span><span class="sign">&gt;</span>nj <span class="sign">=</span> theCurve<span class="sign">-</span><span class="sign">&gt;</span>SplineNknots <span class="sign">+</span> theCurve<span class="sign">-</span><span class="sign">&gt;</span>SplineOrd<span class="sign">;</span>
<span class="line_number">769 </span>        <span class="comment">// get the type of prior on the number of knots</span>
<span class="line_number">770 </span>        const char <span class="sign">*</span> charNknotsPrior <span class="sign">=</span> 
<span class="line_number">771 </span>            CHAR<span class="sign">(</span>STRING_ELT<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"spline.nknots.prior"</span><span class="sign">)</span><span class="sign">,</span>0<span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">772 </span>        nknotsprior iNknotsPrior<span class="sign">;</span>
<span class="line_number">773 </span>        <span class="keyword">if</span><span class="sign">(</span>strcmp<span class="sign">(</span>charNknotsPrior<span class="sign">,</span><span class="quote">"poisson"</span><span class="sign">)</span><span class="sign">=</span><span class="sign">=</span>0<span class="sign">)</span> iNknotsPrior<span class="sign">=</span>PrPoisson<span class="sign">;</span>
<span class="line_number">774 </span>        <span class="keyword">if</span><span class="sign">(</span>strcmp<span class="sign">(</span>charNknotsPrior<span class="sign">,</span><span class="quote">"geometric"</span><span class="sign">)</span><span class="sign">=</span><span class="sign">=</span>0<span class="sign">)</span> iNknotsPrior<span class="sign">=</span>PrGeometric<span class="sign">;</span>
<span class="line_number">775 </span>        <span class="keyword">if</span><span class="sign">(</span>strcmp<span class="sign">(</span>charNknotsPrior<span class="sign">,</span><span class="quote">"poissonmix"</span><span class="sign">)</span><span class="sign">=</span><span class="sign">=</span>0<span class="sign">)</span> iNknotsPrior<span class="sign">=</span>PrPoissonMix<span class="sign">;</span>
<span class="line_number">776 </span>        <span class="keyword">if</span><span class="sign">(</span>strcmp<span class="sign">(</span>charNknotsPrior<span class="sign">,</span><span class="quote">"negbin"</span><span class="sign">)</span><span class="sign">=</span><span class="sign">=</span>0<span class="sign">)</span> iNknotsPrior<span class="sign">=</span>PrNegBin<span class="sign">;</span>
<span class="line_number">777 </span>        <span class="keyword">if</span><span class="sign">(</span>strcmp<span class="sign">(</span>charNknotsPrior<span class="sign">,</span><span class="quote">"power"</span><span class="sign">)</span><span class="sign">=</span><span class="sign">=</span>0<span class="sign">)</span> iNknotsPrior<span class="sign">=</span>PrPower<span class="sign">;</span>
<span class="line_number">778 </span>        theCurve<span class="sign">-</span><span class="sign">&gt;</span>SplineNknotsPrior <span class="sign">=</span> iNknotsPrior<span class="sign">;</span>
<span class="line_number">779 </span>
<span class="line_number">780 </span>        <span class="comment">// get the type of smoothness penalty</span>
<span class="line_number">781 </span>        const char <span class="sign">*</span> charPenaltyType <span class="sign">=</span> 
<span class="line_number">782 </span>            CHAR<span class="sign">(</span>STRING_ELT<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"spline.penalty"</span><span class="sign">)</span><span class="sign">,</span>0<span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">783 </span>        penalty iPenaltyType<span class="sign">;</span>
<span class="line_number">784 </span>        <span class="keyword">if</span> <span class="sign">(</span>strcmp<span class="sign">(</span>charPenaltyType<span class="sign">,</span><span class="quote">"2diff"</span><span class="sign">)</span> <span class="sign">=</span><span class="sign">=</span>0<span class="sign">)</span> <span class="sign">{</span> iPenaltyType<span class="sign">=</span>pdiff<span class="sign">;</span> <span class="sign">}</span>
<span class="line_number">785 </span>        <span class="keyword">else</span> <span class="keyword">if</span> <span class="sign">(</span>strcmp<span class="sign">(</span>charPenaltyType<span class="sign">,</span><span class="quote">"2deriv"</span><span class="sign">)</span> <span class="sign">=</span><span class="sign">=</span>0<span class="sign">)</span> <span class="sign">{</span> iPenaltyType<span class="sign">=</span>pderiv<span class="sign">;</span> <span class="sign">}</span>
<span class="line_number">786 </span>        <span class="keyword">else</span> <span class="keyword">if</span> <span class="sign">(</span>strcmp<span class="sign">(</span>charPenaltyType<span class="sign">,</span><span class="quote">"log2deriv"</span><span class="sign">)</span> <span class="sign">=</span><span class="sign">=</span>0<span class="sign">)</span> <span class="sign">{</span> iPenaltyType<span class="sign">=</span>plogderiv<span class="sign">;</span><span class="sign">}</span>
<span class="line_number">787 </span>        <span class="keyword">else</span> <span class="sign">{</span> iPenaltyType<span class="sign">=</span>pnone<span class="sign">;</span><span class="sign">}</span>
<span class="line_number">788 </span>        theCurve<span class="sign">-</span><span class="sign">&gt;</span>SplinePenaltyType <span class="sign">=</span> iPenaltyType<span class="sign">;</span>
<span class="line_number">789 </span>        <span class="keyword">if</span><span class="sign">(</span>iPenaltyType <span class="sign">!</span><span class="sign">=</span> pnone<span class="sign">)</span> <span class="comment">// if there is a penalty matrix, get it</span>
<span class="line_number">790 </span>            theCurve<span class="sign">-</span><span class="sign">&gt;</span>SplinePenaltyMatrix <span class="sign">=</span> 
<span class="line_number">791 </span>                REAL<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span> <span class="quote">"spline.penaltymatrix"</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">792 </span>        <span class="comment">// scaling factor for penalty</span>
<span class="line_number">793 </span>        theCurve<span class="sign">-</span><span class="sign">&gt;</span>SplinePenaltyFactor <span class="sign">=</span> REAL<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"spline.penaltyfactor"</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">794 </span>        <span class="comment">// vector of spline knots</span>
<span class="line_number">795 </span>        theCurve<span class="sign">-</span><span class="sign">&gt;</span>SplineKnots <span class="sign">=</span>  REAL<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"spline.knots"</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">796 </span>        <span class="comment">// spline basis matrix</span>
<span class="line_number">797 </span>        theCurve<span class="sign">-</span><span class="sign">&gt;</span>SplineBasis <span class="sign">=</span>  REAL<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"spline.basis"</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">798 </span>        <span class="comment">// vector of integrals of each basis function</span>
<span class="line_number">799 </span>        theCurve<span class="sign">-</span><span class="sign">&gt;</span>SplineBasisInt <span class="sign">=</span>  REAL<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"spline.basisint"</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">800 </span>        <span class="comment">// spline parameters</span>
<span class="line_number">801 </span>        theCurve<span class="sign">-</span><span class="sign">&gt;</span>SplinePar <span class="sign">=</span>  REAL<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"spline.par"</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">802 </span>        <span class="comment">// exponentials of spline parameters</span>
<span class="line_number">803 </span>        theCurve<span class="sign">-</span><span class="sign">&gt;</span>SplineEPar <span class="sign">=</span> <span class="sign">(</span><span class="keyword">double</span> <span class="sign">*</span><span class="sign">)</span> <span class="keyword">malloc</span><span class="sign">(</span> 
<span class="line_number">804 </span>                <span class="sign">(</span>theCurve<span class="sign">-</span><span class="sign">&gt;</span>SplineNknotsMax <span class="sign">+</span> theCurve<span class="sign">-</span><span class="sign">&gt;</span>SplineOrd<span class="sign">)</span> <span class="sign">*</span> sizeof<span class="sign">(</span><span class="keyword">double</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">805 </span>        <span class="keyword">for</span><span class="sign">(</span><span class="keyword">int</span> j<span class="sign">=</span>0<span class="sign">;</span> j<span class="sign">&lt;</span> theCurve<span class="sign">-</span><span class="sign">&gt;</span>nj<span class="sign">;</span> j<span class="sign">+</span><span class="sign">+</span><span class="sign">)</span>
<span class="line_number">806 </span>            theCurve<span class="sign">-</span><span class="sign">&gt;</span>SplineEPar<span class="sign">[</span>j<span class="sign">]</span> <span class="sign">=</span> <span class="keyword">exp</span><span class="sign">(</span>theCurve<span class="sign">-</span><span class="sign">&gt;</span>SplinePar<span class="sign">[</span>j<span class="sign">]</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">807 </span>        <span class="comment">// covariance matrix for candidate generation</span>
<span class="line_number">808 </span>        theCurve<span class="sign">-</span><span class="sign">&gt;</span>SplineCandCov <span class="sign">=</span>  REAL<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"spline.candcov"</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">809 </span>        <span class="comment">// cholesky factorization of the covariance matrix</span>
<span class="line_number">810 </span>        theCurve<span class="sign">-</span><span class="sign">&gt;</span>SplineCholCov <span class="sign">=</span>  REAL<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"spline.cholcandcov"</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">811 </span>        <span class="comment">// standard deviations for candidate generation</span>
<span class="line_number">812 </span>        theCurve<span class="sign">-</span><span class="sign">&gt;</span>SplineCandSD <span class="sign">=</span> REAL<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"spline.candsd"</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">813 </span>        <span class="comment">// spline component evaluated at X</span>
<span class="line_number">814 </span>        theCurve<span class="sign">-</span><span class="sign">&gt;</span>SplineY <span class="sign">=</span>  REAL<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"spline.y"</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">815 </span>        <span class="keyword">if</span><span class="sign">(</span>theCurve<span class="sign">-</span><span class="sign">&gt;</span>isHazard<span class="sign">)</span><span class="sign">{</span>
<span class="line_number">816 </span>            <span class="comment">// hazards additionally need cumulative basis functions and cumulative</span>
<span class="line_number">817 </span>            <span class="comment">// spline component integrals</span>
<span class="line_number">818 </span>            theCurve<span class="sign">-</span><span class="sign">&gt;</span>SplineBasisCum <span class="sign">=</span>  REAL<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"spline.basiscum"</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">819 </span>            theCurve<span class="sign">-</span><span class="sign">&gt;</span>SplineYcum <span class="sign">=</span>  REAL<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"spline.ycum"</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">820 </span>        <span class="sign">}</span>
<span class="line_number">821 </span>        <span class="keyword">if</span><span class="sign">(</span><span class="sign">!</span>theCurve<span class="sign">-</span><span class="sign">&gt;</span>isHazard<span class="sign">)</span><span class="sign">{</span>
<span class="line_number">822 </span>            <span class="comment">// frailties need integrals of each basis function</span>
<span class="line_number">823 </span>            theCurve<span class="sign">-</span><span class="sign">&gt;</span>SplineBasisInt <span class="sign">=</span>  REAL<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"spline.basisint"</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">824 </span>            <span class="comment">// 1-expected value of each basis function</span>
<span class="line_number">825 </span>            theCurve<span class="sign">-</span><span class="sign">&gt;</span>SplineBasisExp <span class="sign">=</span>  REAL<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"spline.basisexp"</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">826 </span>            <span class="comment">// sum of exponentials of spline parameters</span>
<span class="line_number">827 </span>            theCurve<span class="sign">-</span><span class="sign">&gt;</span>SplineEParSum <span class="sign">=</span> 0<span class="sign">;</span>
<span class="line_number">828 </span>            <span class="keyword">for</span><span class="sign">(</span><span class="keyword">int</span> j<span class="sign">=</span>0<span class="sign">;</span> j<span class="sign">&lt;</span> theCurve<span class="sign">-</span><span class="sign">&gt;</span>nj<span class="sign">;</span> j<span class="sign">+</span><span class="sign">+</span><span class="sign">)</span> 
<span class="line_number">829 </span>                theCurve<span class="sign">-</span><span class="sign">&gt;</span>SplineEParSum <span class="sign">+</span><span class="sign">=</span> theCurve<span class="sign">-</span><span class="sign">&gt;</span>SplineEPar<span class="sign">[</span>j<span class="sign">]</span><span class="sign">;</span>
<span class="line_number">830 </span>            <span class="comment">// variance of spline component of frailty</span>
<span class="line_number">831 </span>            theCurve<span class="sign">-</span><span class="sign">&gt;</span>SplineFvar <span class="sign">=</span> <a href="./mainloop_cCcurveUpdate2FFrailtySplineVar.html#robo34">FrailtySplineVar</a><span class="sign">(</span>theCurve<span class="sign">)</span><span class="sign">;</span>
<span class="line_number">832 </span>            <span class="comment">// penalty on the distance of the mean from 1</span>
<span class="line_number">833 </span>            theCurve<span class="sign">-</span><span class="sign">&gt;</span>SplineMeanPenalty <span class="sign">=</span> REAL<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"spline.meanpenalty"</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">834 </span>            <span class="comment">// which of the spline parameters is held fixed</span>
<span class="line_number">835 </span>            theCurve<span class="sign">-</span><span class="sign">&gt;</span>SplineFixedInd <span class="sign">=</span> 
<span class="line_number">836 </span>                asInteger<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span> <span class="quote">"spline.fixedind"</span><span class="sign">)</span><span class="sign">)</span> <span class="sign">-</span> 1<span class="sign">;</span>
<span class="line_number">837 </span>        <span class="sign">}</span>
<span class="line_number">838 </span>    <span class="sign">}</span>
<span class="line_number">839 </span>
<span class="line_number">840 </span>    <span class="comment">// parametric component only</span>
<span class="line_number">841 </span>    <span class="keyword">if</span><span class="sign">(</span>theCurve<span class="sign">-</span><span class="sign">&gt;</span>hasPar<span class="sign">)</span><span class="sign">{</span>
<span class="line_number">842 </span>        <span class="comment">// parametric component parameters</span>
<span class="line_number">843 </span>        theCurve<span class="sign">-</span><span class="sign">&gt;</span>ParamPar <span class="sign">=</span> REAL<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"param.par"</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">844 </span>        <span class="comment">// parametric component evaluated at X</span>
<span class="line_number">845 </span>        theCurve<span class="sign">-</span><span class="sign">&gt;</span>ParamY <span class="sign">=</span> REAL<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"param.y"</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">846 </span>        <span class="comment">// cumulative integral for hazard</span>
<span class="line_number">847 </span>        <span class="keyword">if</span><span class="sign">(</span>theCurve<span class="sign">-</span><span class="sign">&gt;</span>isHazard<span class="sign">)</span>
<span class="line_number">848 </span>            theCurve<span class="sign">-</span><span class="sign">&gt;</span>ParamYcum <span class="sign">=</span> REAL<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"param.ycum"</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">849 </span>        <span class="comment">// get parametric distribution</span>
<span class="line_number">850 </span>        const char <span class="sign">*</span> charParamDist <span class="sign">=</span> CHAR<span class="sign">(</span>STRING_ELT<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"param.dist"</span><span class="sign">)</span><span class="sign">,</span>0<span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">851 </span>        distribution iParamDist<span class="sign">;</span>
<span class="line_number">852 </span>        <span class="keyword">if</span><span class="sign">(</span>strcmp<span class="sign">(</span>charParamDist<span class="sign">,</span><span class="quote">"exponential"</span><span class="sign">)</span> <span class="sign">=</span><span class="sign">=</span> 0<span class="sign">)</span> <span class="sign">{</span> iParamDist <span class="sign">=</span> Dexponential<span class="sign">;</span> <span class="sign">}</span> 
<span class="line_number">853 </span>        <span class="keyword">else</span> <span class="keyword">if</span><span class="sign">(</span>strcmp<span class="sign">(</span>charParamDist<span class="sign">,</span><span class="quote">"weibull"</span><span class="sign">)</span> <span class="sign">=</span><span class="sign">=</span> 0<span class="sign">)</span> <span class="sign">{</span> iParamDist <span class="sign">=</span> Dweibull<span class="sign">;</span> <span class="sign">}</span> 
<span class="line_number">854 </span>        <span class="keyword">else</span> <span class="keyword">if</span><span class="sign">(</span>strcmp<span class="sign">(</span>charParamDist<span class="sign">,</span><span class="quote">"gamma"</span><span class="sign">)</span> <span class="sign">=</span><span class="sign">=</span> 0<span class="sign">)</span> <span class="sign">{</span> iParamDist <span class="sign">=</span> Dgamma<span class="sign">;</span> <span class="sign">}</span> 
<span class="line_number">855 </span>        <span class="keyword">else</span> <span class="keyword">if</span><span class="sign">(</span>strcmp<span class="sign">(</span>charParamDist<span class="sign">,</span><span class="quote">"lognormal"</span><span class="sign">)</span> <span class="sign">=</span><span class="sign">=</span> 0<span class="sign">)</span> <span class="sign">{</span> iParamDist <span class="sign">=</span> Dlognormal<span class="sign">;</span> <span class="sign">}</span> 
<span class="line_number">856 </span>        <span class="keyword">else</span> <span class="sign">{</span> iParamDist <span class="sign">=</span> Dnone<span class="sign">;</span> <span class="sign">}</span> 
<span class="line_number">857 </span>        theCurve<span class="sign">-</span><span class="sign">&gt;</span>ParDist <span class="sign">=</span> iParamDist<span class="sign">;</span>
<span class="line_number">858 </span>        <span class="comment">// number of parametric component parameters</span>
<span class="line_number">859 </span>        theCurve<span class="sign">-</span><span class="sign">&gt;</span>np <span class="sign">=</span> <span class="sign">(</span><span class="keyword">int</span><span class="sign">)</span> <span class="sign">(</span><span class="keyword">length</span><span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"param.par"</span><span class="sign">)</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">860 </span>        <span class="comment">// candidate generation for parametric component parameters</span>
<span class="line_number">861 </span>        theCurve<span class="sign">-</span><span class="sign">&gt;</span>ParamCandCov <span class="sign">=</span>  REAL<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"param.candcov"</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">862 </span>        theCurve<span class="sign">-</span><span class="sign">&gt;</span>ParamCholCov <span class="sign">=</span>  REAL<span class="sign">(</span><a href="./mainloop_cCmiscUtils2FgetListElement.html#robo88">getListElement</a><span class="sign">(</span>Rcurve<span class="sign">,</span><span class="quote">"param.cholcandcov"</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">863 </span>    <span class="sign">}</span>
<span class="line_number">864 </span><span class="sign">}</span>
</pre>

</div> <!-- content -->
<div id="footer">
<p>Generated from ./splinesurv/src/mainloop.c with <a href="http://www.xs4all.nl/~rfsber/Robo/robodoc.html">ROBODoc</a> V4.99.36 on Wed Jul 16 2008 11:21:32
</p>
</div> <!-- footer -->

<!-- Start of StatCounter Code -->
<script type="text/javascript">
var sc_project=3825578; 
var sc_invisible=1; 
var sc_partition=34; 
var sc_click_stat=1; 
var sc_security="6730661a"; 
</script>

<script type="text/javascript" src="http://www.statcounter.com/counter/counter_xhtml.js"></script><noscript><div class="statcounter"><a href="http://www.statcounter.com/" target="_blank"><img class="statcounter" src="http://c.statcounter.com/3825578/0/6730661a/1/" alt="free hit counter script" ></a></div></noscript>
<!-- End of StatCounter Code -->
</body>

</html>
