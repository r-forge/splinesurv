<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Style-Type" content="text/css" />
<meta http-equiv="Content-type" content="text/html; charset=ISO-8859-1" />
<link rel="stylesheet" href="../robodoc.css" type="text/css" />
<title>./splinesurv/R/splinefrailty.r</title>
<!-- Source: ./splinesurv/R/splinefrailty.r -->
<!-- Generated with ROBODoc Version 4.99.36 (Jun 17 2008) -->
</head>
<body>
<div id="logo">

<a name="robo_top_of_doc" href="http://splinesurv.r-forge.r-project.org/">splinesurv</a>
</div> <!-- logo -->
<div id="navigation">
<a class="menuitem" href="./splinefrailty_r2FS3Methods.html#robo5">S3Methods</a><a class="menuitem" href="../robo_functions.html#robo_top_of_doc">Functions</a></div> <!-- navigation -->
<div id="content">
<h3>TABLE OF CONTENTS</h3>
<ul>
<li>1. <a href="#robo160">S3Methods/plot.splinesurv</a></li>
</ul>
<hr />
<a name="S3Methods2fplot2esplinesurv"></a>
<a name="robo160"></a><h2>S3Methods/plot.splinesurv [ Functions ]</h2>

<p class="item_name">NAME</p>
<pre>    <strong>plot.splinesurv</strong> --- plot method for <a href="./splinefrailty_rS3Methods2Fsplinesurv.html#robo166">splinesurv</a> objects
</pre>
<p class="item_name">FUNCTION</p>
<p>    Plots either a hazard, frailty, survival curve estimate, or coefficient density.
    There are a large number of options and settings, consult the package documentation
    for details on the options.
</p>

<p>    This function mainly works by calling the predict function to construct the
    curve fits. Most of the rest is just handling inputs and keeping track of the
    various parameters needed by different plotting routines.
</p>
<p class="item_name">SYNOPSIS</p>
<pre class="source"><span class="line_number">3772 </span><strong>plot.splinesurv</strong> <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">function</span><span class="sign">(</span>x<span class="sign">,</span> <span class="keyword">which</span> <span class="sign">=</span> c<span class="sign">(</span><span class="quote">"hazard"</span><span class="sign">,</span> <span class="quote">"survival"</span><span class="sign">,</span> <span class="quote">"frailty"</span><span class="sign">,</span> <span class="quote">"coef"</span><span class="sign">,</span> <span class="quote">"all"</span><span class="sign">)</span><span class="sign">,</span>
<span class="line_number">3773 </span>    newdata <span class="sign">=</span> NULL<span class="sign">,</span> iter <span class="sign">=</span> NULL<span class="sign">,</span> fn <span class="sign">=</span> mean<span class="sign">,</span> plotknots <span class="sign">=</span> TRUE<span class="sign">,</span> npoints <span class="sign">=</span> 100<span class="sign">,</span> npost <span class="sign">=</span> 100<span class="sign">,</span>
<span class="line_number">3774 </span>    alpha<span class="sign">=</span><span class="sign">.</span>05<span class="sign">,</span> legend <span class="sign">=</span> NULL<span class="sign">,</span> lty <span class="sign">=</span> 1<span class="sign">,</span> col <span class="sign">=</span> 2<span class="sign">,</span> lwd <span class="sign">=</span> 2<span class="sign">,</span> lty<span class="sign">.</span>knots <span class="sign">=</span> 1<span class="sign">,</span> col<span class="sign">.</span>knots <span class="sign">=</span> 8<span class="sign">,</span>
<span class="line_number">3775 </span>    lwd<span class="sign">.</span>knots <span class="sign">=</span> 1<span class="sign">,</span> xlab <span class="sign">=</span> NULL<span class="sign">,</span> ylab <span class="sign">=</span> NULL<span class="sign">,</span> main <span class="sign">=</span> NULL<span class="sign">,</span> xlim <span class="sign">=</span> NULL<span class="sign">,</span> ylim <span class="sign">=</span> NULL<span class="sign">,</span>
<span class="line_number">3776 </span>    tk <span class="sign">=</span> FALSE<span class="sign">,</span> <span class="sign">.</span><span class="sign">.</span><span class="sign">.</span><span class="sign">)</span>
</pre>
<p class="item_name">SOURCE</p>
<pre class="source"><span class="line_number">3779 </span><span class="sign">{</span>
<span class="line_number">3780 </span>    
<span class="line_number">3781 </span>    <span class="keyword">if</span><span class="sign">(</span>tk<span class="sign">)</span> <span class="sign">{</span>
<span class="line_number">3782 </span>        <span class="comment"># call the routine that uses tcltk via the tkrplot to plot an interactive</span>
<span class="line_number">3783 </span>        <span class="comment"># curve viewer</span>
<span class="line_number">3784 </span>        <a href="./splinefrailty_rS3Methods2Fsplinesurvtkplot.html#robo169">splinesurvtkplot</a><span class="sign">(</span>x<span class="sign">,</span> newdata <span class="sign">=</span> newdata<span class="sign">,</span> plotknots <span class="sign">=</span> plotknots<span class="sign">,</span> npoints <span class="sign">=</span> npoints<span class="sign">,</span>
<span class="line_number">3785 </span>            legend <span class="sign">=</span> legend<span class="sign">,</span> lty <span class="sign">=</span> lty<span class="sign">,</span> col <span class="sign">=</span> col<span class="sign">,</span> lwd <span class="sign">=</span> lwd<span class="sign">,</span> lty<span class="sign">.</span>knots <span class="sign">=</span> lty<span class="sign">.</span>knots<span class="sign">,</span>
<span class="line_number">3786 </span>            col<span class="sign">.</span>knots <span class="sign">=</span> col<span class="sign">.</span>knots<span class="sign">,</span> lwd<span class="sign">.</span>knots <span class="sign">=</span> lwd<span class="sign">.</span>knots<span class="sign">,</span> xlab <span class="sign">=</span> xlab<span class="sign">,</span> ylab <span class="sign">=</span> ylab<span class="sign">,</span>
<span class="line_number">3787 </span>            main <span class="sign">=</span> main<span class="sign">,</span> xlim <span class="sign">=</span> xlim<span class="sign">,</span> ylim <span class="sign">=</span> ylim<span class="sign">,</span> <span class="sign">.</span><span class="sign">.</span><span class="sign">.</span><span class="sign">)</span>
<span class="line_number">3788 </span>        <span class="keyword">return</span><span class="sign">(</span>invisible<span class="sign">(</span><span class="sign">)</span><span class="sign">)</span><span class="sign">;</span>
<span class="line_number">3789 </span>    <span class="sign">}</span>
<span class="line_number">3790 </span>    <span class="comment"># save old parameters</span>
<span class="line_number">3791 </span>    oldask <span class="sign">&lt;</span><span class="sign">-</span> par<span class="sign">(</span><span class="quote">"ask"</span><span class="sign">)</span>
<span class="line_number">3792 </span>    <span class="keyword">which</span> <span class="sign">&lt;</span><span class="sign">-</span> match<span class="sign">.</span>arg<span class="sign">(</span><span class="keyword">which</span><span class="sign">)</span>
<span class="line_number">3793 </span>    <span class="keyword">if</span><span class="sign">(</span><span class="keyword">which</span> <span class="sign">=</span><span class="sign">=</span> <span class="quote">"all"</span><span class="sign">)</span> par<span class="sign">(</span>ask <span class="sign">=</span> TRUE<span class="sign">)</span>
<span class="line_number">3794 </span>    <span class="keyword">if</span><span class="sign">(</span><span class="sign">!</span>is<span class="sign">.</span>null<span class="sign">(</span>iter<span class="sign">)</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> iter <span class="sign">&lt;</span><span class="sign">=</span> 0<span class="sign">)</span> iter <span class="sign">&lt;</span><span class="sign">-</span> NULL
<span class="line_number">3795 </span>    <span class="comment"># Hazard and survival curve plotting</span>
<span class="line_number">3796 </span>    <span class="keyword">if</span><span class="sign">(</span><span class="keyword">which</span> <span class="sign">=</span><span class="sign">=</span> <span class="quote">"hazard"</span> <span class="sign">|</span> <span class="keyword">which</span> <span class="sign">=</span><span class="sign">=</span> <span class="quote">"survival"</span> <span class="sign">|</span> <span class="keyword">which</span> <span class="sign">=</span><span class="sign">=</span> <span class="quote">"all"</span><span class="sign">)</span><span class="sign">{</span>
<span class="line_number">3797 </span>        type <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">if</span><span class="sign">(</span><span class="keyword">which</span> <span class="sign">=</span><span class="sign">=</span> <span class="quote">"all"</span><span class="sign">)</span> <span class="quote">"hazard"</span> <span class="keyword">else</span> <span class="keyword">which</span>
<span class="line_number">3798 </span>        <span class="comment"># get the set of knots to use. If an iteration is given, use knots for</span>
<span class="line_number">3799 </span>        <span class="comment"># that iteration, otherwise use only boundary knots</span>
<span class="line_number">3800 </span>        <span class="keyword">if</span><span class="sign">(</span>is<span class="sign">.</span>null<span class="sign">(</span>x<span class="sign">$</span>hazard<span class="sign">$</span>spline<span class="sign">.</span>knots<span class="sign">)</span><span class="sign">)</span><span class="sign">{</span>
<span class="line_number">3801 </span>            knots <span class="sign">&lt;</span><span class="sign">-</span> NULL
<span class="line_number">3802 </span>        <span class="sign">}</span><span class="keyword">else</span><span class="sign">{</span>
<span class="line_number">3803 </span>            <span class="keyword">if</span><span class="sign">(</span>is<span class="sign">.</span>null<span class="sign">(</span>iter<span class="sign">)</span><span class="sign">)</span> <span class="sign">{</span>
<span class="line_number">3804 </span>                knots <span class="sign">&lt;</span><span class="sign">-</span> x<span class="sign">$</span>history<span class="sign">$</span>hazard<span class="sign">.</span>spline<span class="sign">.</span>knots<span class="sign">[</span>1<span class="sign">,</span> <span class="sign">]</span><span class="sign">;</span>knots <span class="sign">&lt;</span><span class="sign">-</span> knots<span class="sign">[</span>knots<span class="sign">&gt;</span><span class="sign">-</span>Inf<span class="sign">]</span>
<span class="line_number">3805 </span>                knots <span class="sign">&lt;</span><span class="sign">-</span> c<span class="sign">(</span>min<span class="sign">(</span>knots<span class="sign">)</span><span class="sign">,</span> max<span class="sign">(</span>knots<span class="sign">)</span><span class="sign">)</span>
<span class="line_number">3806 </span>            <span class="sign">}</span><span class="keyword">else</span><span class="sign">{</span> 
<span class="line_number">3807 </span>                knots <span class="sign">&lt;</span><span class="sign">-</span> x<span class="sign">$</span>history<span class="sign">$</span>hazard<span class="sign">.</span>spline<span class="sign">.</span>knots<span class="sign">[</span>iter<span class="sign">,</span> <span class="sign">]</span><span class="sign">;</span>knots <span class="sign">&lt;</span><span class="sign">-</span> knots<span class="sign">[</span>knots<span class="sign">&gt;</span><span class="sign">-</span>Inf<span class="sign">]</span>
<span class="line_number">3808 </span>            <span class="sign">}</span>
<span class="line_number">3809 </span>        <span class="sign">}</span>
<span class="line_number">3810 </span>        <span class="keyword">if</span><span class="sign">(</span>is<span class="sign">.</span>null<span class="sign">(</span>knots<span class="sign">)</span><span class="sign">)</span> knots <span class="sign">&lt;</span><span class="sign">-</span> range<span class="sign">(</span>x<span class="sign">$</span>data<span class="sign">$</span>time<span class="sign">)</span>
<span class="line_number">3811 </span>        <span class="keyword">if</span><span class="sign">(</span>is<span class="sign">.</span>null<span class="sign">(</span>xlim<span class="sign">)</span><span class="sign">)</span> xlim1 <span class="sign">=</span> range<span class="sign">(</span>x<span class="sign">$</span>data<span class="sign">$</span>time<span class="sign">)</span> <span class="keyword">else</span> xlim1 <span class="sign">&lt;</span><span class="sign">-</span> xlim
<span class="line_number">3812 </span>        <span class="comment"># set the points at which the curve should be predicted</span>
<span class="line_number">3813 </span>        times <span class="sign">=</span> seq<span class="sign">(</span>from <span class="sign">=</span> max<span class="sign">(</span>xlim1<span class="sign">[</span>1<span class="sign">]</span><span class="sign">,</span> min<span class="sign">(</span>knots<span class="sign">)</span><span class="sign">)</span><span class="sign">,</span> to <span class="sign">=</span> min<span class="sign">(</span>xlim1<span class="sign">[</span>2<span class="sign">]</span><span class="sign">,</span> max<span class="sign">(</span>knots<span class="sign">)</span><span class="sign">)</span><span class="sign">,</span>
<span class="line_number">3814 </span>            <span class="keyword">length</span> <span class="sign">=</span> npoints<span class="sign">)</span>
<span class="line_number">3815 </span>        <span class="keyword">if</span><span class="sign">(</span>is<span class="sign">.</span>null<span class="sign">(</span>xlab<span class="sign">)</span><span class="sign">)</span> xlab1 <span class="sign">&lt;</span><span class="sign">-</span> <span class="quote">"Time"</span> <span class="keyword">else</span> xlab1 <span class="sign">&lt;</span><span class="sign">-</span> xlab
<span class="line_number">3816 </span>        <span class="comment"># set axis labels</span>
<span class="line_number">3817 </span>        <span class="keyword">if</span><span class="sign">(</span>type <span class="sign">=</span><span class="sign">=</span> <span class="quote">"hazard"</span><span class="sign">)</span><span class="sign">{</span>
<span class="line_number">3818 </span>            <span class="keyword">if</span><span class="sign">(</span>is<span class="sign">.</span>null<span class="sign">(</span>ylab<span class="sign">)</span><span class="sign">)</span> ylab1 <span class="sign">&lt;</span><span class="sign">-</span> <span class="quote">"Hazard"</span> <span class="keyword">else</span> ylab1 <span class="sign">&lt;</span><span class="sign">-</span> ylab
<span class="line_number">3819 </span>            <span class="keyword">if</span><span class="sign">(</span>is<span class="sign">.</span>null<span class="sign">(</span>main<span class="sign">)</span><span class="sign">)</span><span class="sign">{</span>
<span class="line_number">3820 </span>                <span class="keyword">if</span><span class="sign">(</span>is<span class="sign">.</span>null<span class="sign">(</span>newdata<span class="sign">)</span><span class="sign">)</span> main1 <span class="sign">&lt;</span><span class="sign">-</span> <span class="quote">"Baseline hazard"</span> 
<span class="line_number">3821 </span>                <span class="keyword">else</span> main1 <span class="sign">&lt;</span><span class="sign">-</span> <span class="quote">"Hazard"</span>
<span class="line_number">3822 </span>            <span class="sign">}</span><span class="keyword">else</span><span class="sign">{</span> main1 <span class="sign">&lt;</span><span class="sign">-</span> main <span class="sign">}</span>
<span class="line_number">3823 </span>        <span class="sign">}</span>
<span class="line_number">3824 </span>        <span class="keyword">if</span><span class="sign">(</span>type <span class="sign">=</span><span class="sign">=</span> <span class="quote">"survival"</span><span class="sign">)</span><span class="sign">{</span>
<span class="line_number">3825 </span>            <span class="keyword">if</span><span class="sign">(</span>is<span class="sign">.</span>null<span class="sign">(</span>ylab<span class="sign">)</span><span class="sign">)</span> ylab1 <span class="sign">&lt;</span><span class="sign">-</span> <span class="quote">"Survival"</span> <span class="keyword">else</span> ylab1 <span class="sign">&lt;</span><span class="sign">-</span> ylab
<span class="line_number">3826 </span>            <span class="keyword">if</span><span class="sign">(</span>is<span class="sign">.</span>null<span class="sign">(</span>main<span class="sign">)</span><span class="sign">)</span><span class="sign">{</span>
<span class="line_number">3827 </span>                <span class="keyword">if</span><span class="sign">(</span>is<span class="sign">.</span>null<span class="sign">(</span>newdata<span class="sign">)</span><span class="sign">)</span> main1 <span class="sign">&lt;</span><span class="sign">-</span> <span class="quote">"Baseline survival"</span> 
<span class="line_number">3828 </span>                <span class="keyword">else</span> main1 <span class="sign">&lt;</span><span class="sign">-</span> <span class="quote">"Survival"</span>
<span class="line_number">3829 </span>            <span class="sign">}</span><span class="keyword">else</span><span class="sign">{</span> main1 <span class="sign">&lt;</span><span class="sign">-</span> main <span class="sign">}</span>
<span class="line_number">3830 </span>        <span class="sign">}</span>
<span class="line_number">3831 </span>        <span class="comment"># a single curve is plotted if either no newdata is given, or newdata has only one row</span>
<span class="line_number">3832 </span>        <span class="keyword">if</span><span class="sign">(</span>is<span class="sign">.</span>null<span class="sign">(</span>newdata<span class="sign">)</span> <span class="sign">|</span> <span class="sign">(</span><span class="sign">!</span>is<span class="sign">.</span>null<span class="sign">(</span>newdata<span class="sign">)</span> <span class="sign">&amp;</span><span class="sign">&amp;</span> <span class="keyword">dim</span><span class="sign">(</span>newdata<span class="sign">)</span><span class="sign">[</span>1<span class="sign">]</span> <span class="sign">&lt;</span> 2<span class="sign">)</span><span class="sign">)</span><span class="sign">{</span>
<span class="line_number">3833 </span>            <span class="comment"># estimate the hazard curve</span>
<span class="line_number">3834 </span>            haz <span class="sign">&lt;</span><span class="sign">-</span> predict<span class="sign">(</span>x<span class="sign">,</span> type <span class="sign">=</span> type<span class="sign">,</span> x <span class="sign">=</span> times<span class="sign">,</span> newdata <span class="sign">=</span> newdata<span class="sign">,</span> iter <span class="sign">=</span> iter<span class="sign">,</span> fn <span class="sign">=</span> fn<span class="sign">,</span>
<span class="line_number">3835 </span>                npost <span class="sign">=</span> npost<span class="sign">,</span> alpha <span class="sign">=</span> alpha<span class="sign">)</span>
<span class="line_number">3836 </span>            plot<span class="sign">(</span>haz<span class="sign">[</span><span class="sign">,</span> 1<span class="sign">:</span>2<span class="sign">]</span><span class="sign">,</span> type <span class="sign">=</span> <span class="quote">"l"</span><span class="sign">,</span> lty <span class="sign">=</span> lty<span class="sign">,</span> col <span class="sign">=</span> col<span class="sign">,</span> lwd <span class="sign">=</span> lwd<span class="sign">,</span> main <span class="sign">=</span> main1<span class="sign">,</span>
<span class="line_number">3837 </span>                xlab <span class="sign">=</span> xlab1<span class="sign">,</span> ylab <span class="sign">=</span> ylab1<span class="sign">,</span> xlim <span class="sign">=</span> xlim1<span class="sign">,</span> ylim <span class="sign">=</span> ylim<span class="sign">,</span> <span class="sign">.</span><span class="sign">.</span><span class="sign">.</span><span class="sign">)</span>
<span class="line_number">3838 </span>            <span class="comment"># plot knots as vertical lines</span>
<span class="line_number">3839 </span>            <span class="keyword">if</span><span class="sign">(</span>plotknots<span class="sign">)</span> <span class="sign">{</span>
<span class="line_number">3840 </span>                abline<span class="sign">(</span>v <span class="sign">=</span> knots<span class="sign">,</span> col <span class="sign">=</span> col<span class="sign">.</span>knots<span class="sign">,</span> lty <span class="sign">=</span> lty<span class="sign">.</span>knots<span class="sign">,</span> lwd <span class="sign">=</span> lwd<span class="sign">.</span>knots<span class="sign">,</span> <span class="sign">.</span><span class="sign">.</span><span class="sign">.</span><span class="sign">)</span>
<span class="line_number">3841 </span>                lines<span class="sign">(</span>haz<span class="sign">,</span> lty <span class="sign">=</span> lty<span class="sign">,</span> col <span class="sign">=</span> col<span class="sign">,</span> lwd <span class="sign">=</span> lwd<span class="sign">)</span>
<span class="line_number">3842 </span>            <span class="sign">}</span>
<span class="line_number">3843 </span>            <span class="comment"># plot confidence intervals</span>
<span class="line_number">3844 </span>            <span class="keyword">if</span><span class="sign">(</span><span class="sign">!</span>is<span class="sign">.</span>null<span class="sign">(</span>alpha<span class="sign">)</span> <span class="sign">&amp;</span> is<span class="sign">.</span>null<span class="sign">(</span>iter<span class="sign">)</span><span class="sign">)</span><span class="sign">{</span>
<span class="line_number">3845 </span>                lines<span class="sign">(</span>haz<span class="sign">[</span><span class="sign">,</span> c<span class="sign">(</span>1<span class="sign">,</span> 3<span class="sign">)</span><span class="sign">]</span><span class="sign">,</span> lty <span class="sign">=</span> 2<span class="sign">,</span> col <span class="sign">=</span> col<span class="sign">)</span>
<span class="line_number">3846 </span>                lines<span class="sign">(</span>haz<span class="sign">[</span><span class="sign">,</span> c<span class="sign">(</span>1<span class="sign">,</span> 4<span class="sign">)</span><span class="sign">]</span><span class="sign">,</span> lty <span class="sign">=</span> 2<span class="sign">,</span> col <span class="sign">=</span> col<span class="sign">)</span>
<span class="line_number">3847 </span>            <span class="sign">}</span>
<span class="line_number">3848 </span>        <span class="comment"># if newdata has more than one row, multiple lines have to be predicted and plotted</span>
<span class="line_number">3849 </span>        <span class="sign">}</span><span class="keyword">else</span><span class="sign">{</span>
<span class="line_number">3850 </span>            haz <span class="sign">&lt;</span><span class="sign">-</span> times
<span class="line_number">3851 </span>            <span class="comment"># predict a curve for each row of newdata</span>
<span class="line_number">3852 </span>            <span class="keyword">for</span><span class="sign">(</span>i in 1<span class="sign">:</span><span class="keyword">dim</span><span class="sign">(</span>newdata<span class="sign">)</span><span class="sign">[</span>1<span class="sign">]</span><span class="sign">)</span> haz <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">cbind</span><span class="sign">(</span>haz<span class="sign">,</span> predict<span class="sign">(</span>x<span class="sign">,</span> type <span class="sign">=</span> type<span class="sign">,</span> x <span class="sign">=</span> times<span class="sign">,</span>
<span class="line_number">3853 </span>                newdata <span class="sign">=</span> newdata<span class="sign">[</span>i<span class="sign">,</span> <span class="sign">,</span>drop <span class="sign">=</span> FALSE<span class="sign">]</span><span class="sign">,</span> iter <span class="sign">=</span> iter<span class="sign">,</span> fn <span class="sign">=</span> fn<span class="sign">,</span> npost <span class="sign">=</span> npost<span class="sign">)</span><span class="sign">[</span><span class="sign">,</span> 2<span class="sign">]</span><span class="sign">)</span>
<span class="line_number">3854 </span>            <span class="keyword">if</span><span class="sign">(</span><span class="keyword">length</span><span class="sign">(</span>col<span class="sign">)</span> <span class="sign">=</span><span class="sign">=</span> 1 <span class="sign">&amp;</span> <span class="keyword">length</span><span class="sign">(</span>lty<span class="sign">)</span> <span class="sign">=</span><span class="sign">=</span> 1 <span class="sign">&amp;</span> <span class="keyword">length</span><span class="sign">(</span>lwd<span class="sign">)</span> <span class="sign">=</span><span class="sign">=</span> 1<span class="sign">)</span> col <span class="sign">=</span> 1<span class="sign">:</span><span class="keyword">dim</span><span class="sign">(</span>newdata<span class="sign">)</span><span class="sign">[</span>1<span class="sign">]</span>
<span class="line_number">3855 </span>            <span class="comment"># plot all the new lines</span>
<span class="line_number">3856 </span>            matplot<span class="sign">(</span>haz<span class="sign">[</span><span class="sign">,</span> 1<span class="sign">]</span><span class="sign">,</span> haz<span class="sign">[</span><span class="sign">,</span> <span class="sign">-</span>1<span class="sign">]</span><span class="sign">,</span> type <span class="sign">=</span> <span class="quote">"l"</span><span class="sign">,</span> col <span class="sign">=</span> col<span class="sign">,</span> lwd <span class="sign">=</span> lwd<span class="sign">,</span> lty <span class="sign">=</span> lty<span class="sign">,</span>
<span class="line_number">3857 </span>                main <span class="sign">=</span> main1<span class="sign">,</span> xlab <span class="sign">=</span> xlab1<span class="sign">,</span> ylab <span class="sign">=</span> ylab1<span class="sign">,</span> xlim <span class="sign">=</span> xlim1<span class="sign">,</span> ylim <span class="sign">=</span> ylim<span class="sign">,</span> <span class="sign">.</span><span class="sign">.</span><span class="sign">.</span><span class="sign">)</span>
<span class="line_number">3858 </span>            <span class="keyword">if</span><span class="sign">(</span>is<span class="sign">.</span>null<span class="sign">(</span>legend<span class="sign">)</span><span class="sign">)</span> legend <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">rownames</span><span class="sign">(</span>newdata<span class="sign">)</span>
<span class="line_number">3859 </span>            <span class="comment"># plot knots as vertical lines</span>
<span class="line_number">3860 </span>            <span class="keyword">if</span><span class="sign">(</span>plotknots<span class="sign">)</span> abline<span class="sign">(</span>v <span class="sign">=</span> knots<span class="sign">,</span> col <span class="sign">=</span> col<span class="sign">.</span>knots<span class="sign">,</span> lty <span class="sign">=</span> lty<span class="sign">.</span>knots<span class="sign">,</span>
<span class="line_number">3861 </span>                lwd <span class="sign">=</span> lwd<span class="sign">.</span>knots<span class="sign">,</span> <span class="sign">.</span><span class="sign">.</span><span class="sign">.</span><span class="sign">)</span>
<span class="line_number">3862 </span>            <span class="comment"># add a legend</span>
<span class="line_number">3863 </span>            <span class="keyword">if</span><span class="sign">(</span><span class="sign">!</span>is<span class="sign">.</span>na<span class="sign">(</span>legend<span class="sign">)</span><span class="sign">)</span> legend<span class="sign">(</span><span class="quote">"topright"</span><span class="sign">,</span> legend <span class="sign">=</span> legend<span class="sign">,</span> col <span class="sign">=</span> col<span class="sign">,</span> lty <span class="sign">=</span> lty<span class="sign">,</span>
<span class="line_number">3864 </span>                lwd <span class="sign">=</span> lwd<span class="sign">)</span>
<span class="line_number">3865 </span>        <span class="sign">}</span>
<span class="line_number">3866 </span>        <span class="keyword">if</span><span class="sign">(</span><span class="keyword">which</span> <span class="sign">=</span><span class="sign">=</span> <span class="quote">"all"</span><span class="sign">)</span> plot<span class="sign">(</span>x<span class="sign">,</span> <span class="keyword">which</span> <span class="sign">=</span> <span class="quote">"survival"</span><span class="sign">,</span> newdata <span class="sign">=</span> newdata<span class="sign">,</span> iter <span class="sign">=</span> iter<span class="sign">,</span>
<span class="line_number">3867 </span>            plotknots <span class="sign">=</span> plotknots<span class="sign">,</span> npoints <span class="sign">=</span> npoints<span class="sign">,</span> npost <span class="sign">=</span> npost<span class="sign">,</span> alpha <span class="sign">=</span> alpha<span class="sign">,</span>
<span class="line_number">3868 </span>            legend <span class="sign">=</span> legend<span class="sign">,</span> lty <span class="sign">=</span> lty<span class="sign">,</span> col <span class="sign">=</span> col<span class="sign">,</span> lwd <span class="sign">=</span> lwd<span class="sign">,</span> lty<span class="sign">.</span>knots <span class="sign">=</span> lty<span class="sign">.</span>knots<span class="sign">,</span>
<span class="line_number">3869 </span>            col<span class="sign">.</span>knots <span class="sign">=</span> col<span class="sign">.</span>knots<span class="sign">,</span> xlab <span class="sign">=</span> xlab<span class="sign">,</span> ylab <span class="sign">=</span> ylab<span class="sign">,</span> main <span class="sign">=</span> main<span class="sign">,</span> xlim <span class="sign">=</span> xlim<span class="sign">,</span>
<span class="line_number">3870 </span>            ylim <span class="sign">=</span> ylim<span class="sign">,</span> tk <span class="sign">=</span> tk<span class="sign">,</span> <span class="sign">.</span><span class="sign">.</span><span class="sign">.</span><span class="sign">)</span>
<span class="line_number">3871 </span>    <span class="sign">}</span>
<span class="line_number">3872 </span>    <span class="comment"># Frailty density plotting</span>
<span class="line_number">3873 </span>    <span class="keyword">if</span><span class="sign">(</span><span class="keyword">which</span> <span class="sign">=</span><span class="sign">=</span> <span class="quote">"frailty"</span> <span class="sign">|</span> <span class="keyword">which</span> <span class="sign">=</span><span class="sign">=</span> <span class="quote">"all"</span><span class="sign">)</span><span class="sign">{</span>
<span class="line_number">3874 </span>        knots <span class="sign">&lt;</span><span class="sign">-</span> x<span class="sign">$</span>frailty<span class="sign">$</span>spline<span class="sign">.</span>knots
<span class="line_number">3875 </span>        <span class="comment"># construct knots to use</span>
<span class="line_number">3876 </span>        <span class="keyword">if</span><span class="sign">(</span>is<span class="sign">.</span>null<span class="sign">(</span>iter<span class="sign">)</span><span class="sign">)</span><span class="sign">{</span> 
<span class="line_number">3877 </span>                knots <span class="sign">&lt;</span><span class="sign">-</span> x<span class="sign">$</span>history<span class="sign">$</span>frailty<span class="sign">.</span>spline<span class="sign">.</span>knots<span class="sign">[</span>1<span class="sign">,</span> <span class="sign">]</span><span class="sign">;</span>knots <span class="sign">&lt;</span><span class="sign">-</span> knots<span class="sign">[</span>knots<span class="sign">&gt;</span><span class="sign">-</span>Inf<span class="sign">]</span>
<span class="line_number">3878 </span>                knots <span class="sign">&lt;</span><span class="sign">-</span> c<span class="sign">(</span>min<span class="sign">(</span>knots<span class="sign">)</span><span class="sign">,</span> max<span class="sign">(</span>knots<span class="sign">)</span><span class="sign">)</span>
<span class="line_number">3879 </span>        <span class="sign">}</span> <span class="keyword">else</span><span class="sign">{</span> 
<span class="line_number">3880 </span>            knots <span class="sign">&lt;</span><span class="sign">-</span> x<span class="sign">$</span>history<span class="sign">$</span>frailty<span class="sign">.</span>spline<span class="sign">.</span>knots<span class="sign">[</span>iter<span class="sign">,</span> <span class="sign">]</span><span class="sign">;</span>knots <span class="sign">&lt;</span><span class="sign">-</span> knots<span class="sign">[</span>knots<span class="sign">&gt;</span><span class="sign">-</span>Inf<span class="sign">]</span>
<span class="line_number">3881 </span>        <span class="sign">}</span>
<span class="line_number">3882 </span>        <span class="keyword">if</span><span class="sign">(</span>is<span class="sign">.</span>null<span class="sign">(</span>knots<span class="sign">)</span><span class="sign">)</span> knots <span class="sign">&lt;</span><span class="sign">-</span> range<span class="sign">(</span>x<span class="sign">$</span>posterior<span class="sign">.</span>mean<span class="sign">$</span>frailty<span class="sign">)</span>
<span class="line_number">3883 </span>        <span class="comment"># limits on the graph</span>
<span class="line_number">3884 </span>        <span class="keyword">if</span><span class="sign">(</span>is<span class="sign">.</span>null<span class="sign">(</span>xlim<span class="sign">)</span><span class="sign">)</span> <span class="sign">{</span>
<span class="line_number">3885 </span>               <span class="keyword">if</span><span class="sign">(</span><a href="./splinefrailty_rmiscUtils2Fhasspline.html#robo155">hasspline</a><span class="sign">(</span>x<span class="sign">$</span>frailty<span class="sign">)</span><span class="sign">)</span> xlim1 <span class="sign">=</span> attr<span class="sign">(</span>knots<span class="sign">,</span> <span class="quote">"b"</span><span class="sign">)</span> 
<span class="line_number">3886 </span>               <span class="keyword">else</span> xlim1 <span class="sign">&lt;</span><span class="sign">-</span> range<span class="sign">(</span>x<span class="sign">$</span>posterior<span class="sign">.</span>mean<span class="sign">$</span>frailty<span class="sign">)</span>
<span class="line_number">3887 </span>       <span class="sign">}</span><span class="keyword">else</span><span class="sign">{</span>xlim1 <span class="sign">&lt;</span><span class="sign">-</span> xlim<span class="sign">}</span>
<span class="line_number">3888 </span>        <span class="comment"># construct the set of values at which the curve shoult be estimated</span>
<span class="line_number">3889 </span>        Ui <span class="sign">=</span> seq<span class="sign">(</span>from <span class="sign">=</span> max<span class="sign">(</span>xlim1<span class="sign">[</span>1<span class="sign">]</span><span class="sign">,</span> min<span class="sign">(</span>knots<span class="sign">)</span><span class="sign">)</span><span class="sign">,</span> to <span class="sign">=</span> min<span class="sign">(</span>xlim1<span class="sign">[</span>2<span class="sign">]</span><span class="sign">,</span> max<span class="sign">(</span>knots<span class="sign">)</span><span class="sign">)</span><span class="sign">,</span>
<span class="line_number">3890 </span>            <span class="keyword">length</span> <span class="sign">=</span> npoints<span class="sign">)</span>
<span class="line_number">3891 </span>        <span class="keyword">if</span><span class="sign">(</span>is<span class="sign">.</span>null<span class="sign">(</span>xlab<span class="sign">)</span><span class="sign">)</span> xlab1 <span class="sign">&lt;</span><span class="sign">-</span> <span class="quote">"x"</span> <span class="keyword">else</span> xlab1 <span class="sign">&lt;</span><span class="sign">-</span> xlab
<span class="line_number">3892 </span>        <span class="keyword">if</span><span class="sign">(</span>is<span class="sign">.</span>null<span class="sign">(</span>ylab<span class="sign">)</span><span class="sign">)</span> ylab1 <span class="sign">&lt;</span><span class="sign">-</span> <span class="quote">"Density"</span> <span class="keyword">else</span> ylab1 <span class="sign">&lt;</span><span class="sign">-</span> ylab
<span class="line_number">3893 </span>        <span class="keyword">if</span><span class="sign">(</span>is<span class="sign">.</span>null<span class="sign">(</span>main<span class="sign">)</span><span class="sign">)</span> main1 <span class="sign">&lt;</span><span class="sign">-</span> <span class="quote">"Frailty density"</span> <span class="keyword">else</span> main1 <span class="sign">&lt;</span><span class="sign">-</span> main
<span class="line_number">3894 </span>        <span class="comment"># comput the curve</span>
<span class="line_number">3895 </span>        dens <span class="sign">&lt;</span><span class="sign">-</span> predict<span class="sign">(</span>x<span class="sign">,</span> type <span class="sign">=</span> <span class="quote">"frailty"</span><span class="sign">,</span> x <span class="sign">=</span> Ui<span class="sign">,</span> iter <span class="sign">=</span> iter<span class="sign">,</span> fn <span class="sign">=</span> fn<span class="sign">,</span> npost <span class="sign">=</span> npost<span class="sign">,</span>
<span class="line_number">3896 </span>            alpha <span class="sign">=</span> alpha<span class="sign">)</span>
<span class="line_number">3897 </span>        <span class="comment"># plot the density curve</span>
<span class="line_number">3898 </span>        plot<span class="sign">(</span>dens<span class="sign">[</span><span class="sign">,</span> 1<span class="sign">:</span>2<span class="sign">]</span><span class="sign">,</span> type <span class="sign">=</span> <span class="quote">"l"</span><span class="sign">,</span> lty <span class="sign">=</span> lty<span class="sign">,</span> col <span class="sign">=</span> col<span class="sign">,</span> lwd <span class="sign">=</span> lwd<span class="sign">,</span> main <span class="sign">=</span> main1<span class="sign">,</span>
<span class="line_number">3899 </span>            xlab <span class="sign">=</span> xlab1<span class="sign">,</span> ylab <span class="sign">=</span> ylab1<span class="sign">,</span> xlim <span class="sign">=</span> xlim1<span class="sign">,</span> ylim <span class="sign">=</span> ylim<span class="sign">,</span> <span class="sign">.</span><span class="sign">.</span><span class="sign">.</span><span class="sign">)</span>
<span class="line_number">3900 </span>        <span class="comment"># plot knots as vertical lines</span>
<span class="line_number">3901 </span>        <span class="keyword">if</span><span class="sign">(</span>plotknots<span class="sign">)</span><span class="sign">{</span>
<span class="line_number">3902 </span>            abline<span class="sign">(</span>v <span class="sign">=</span> knots<span class="sign">,</span> col <span class="sign">=</span> col<span class="sign">.</span>knots<span class="sign">,</span> lty <span class="sign">=</span> lty<span class="sign">.</span>knots<span class="sign">,</span> lwd <span class="sign">=</span> lwd<span class="sign">.</span>knots<span class="sign">,</span> <span class="sign">.</span><span class="sign">.</span><span class="sign">.</span><span class="sign">)</span>
<span class="line_number">3903 </span>            lines<span class="sign">(</span>dens<span class="sign">,</span> type <span class="sign">=</span> <span class="quote">"l"</span><span class="sign">,</span> lty <span class="sign">=</span> lty<span class="sign">,</span> col <span class="sign">=</span> col<span class="sign">,</span> lwd <span class="sign">=</span> lwd<span class="sign">)</span>
<span class="line_number">3904 </span>        <span class="sign">}</span>
<span class="line_number">3905 </span>        <span class="comment"># plot CIs</span>
<span class="line_number">3906 </span>        <span class="keyword">if</span><span class="sign">(</span><span class="sign">!</span>is<span class="sign">.</span>null<span class="sign">(</span>alpha<span class="sign">)</span> <span class="sign">&amp;</span> is<span class="sign">.</span>null<span class="sign">(</span>iter<span class="sign">)</span><span class="sign">)</span><span class="sign">{</span>
<span class="line_number">3907 </span>            lines<span class="sign">(</span>dens<span class="sign">[</span><span class="sign">,</span> c<span class="sign">(</span>1<span class="sign">,</span> 3<span class="sign">)</span><span class="sign">]</span><span class="sign">,</span> lty <span class="sign">=</span> 2<span class="sign">,</span> col <span class="sign">=</span> col<span class="sign">)</span>
<span class="line_number">3908 </span>            lines<span class="sign">(</span>dens<span class="sign">[</span><span class="sign">,</span> c<span class="sign">(</span>1<span class="sign">,</span> 4<span class="sign">)</span><span class="sign">]</span><span class="sign">,</span> lty <span class="sign">=</span> 2<span class="sign">,</span> col <span class="sign">=</span> col<span class="sign">)</span>
<span class="line_number">3909 </span>        <span class="sign">}</span>
<span class="line_number">3910 </span>    <span class="sign">}</span>
<span class="line_number">3911 </span>    <span class="comment"># plot coefficient density</span>
<span class="line_number">3912 </span>    <span class="keyword">if</span><span class="sign">(</span><span class="keyword">which</span> <span class="sign">=</span><span class="sign">=</span> <span class="quote">"coef"</span> <span class="sign">|</span> <span class="keyword">which</span> <span class="sign">=</span><span class="sign">=</span> <span class="quote">"all"</span><span class="sign">)</span><span class="sign">{</span>
<span class="line_number">3913 </span>        burnin <span class="sign">&lt;</span><span class="sign">-</span> x<span class="sign">$</span>control<span class="sign">$</span>burnin
<span class="line_number">3914 </span>        <span class="keyword">if</span><span class="sign">(</span>is<span class="sign">.</span>null<span class="sign">(</span>burnin<span class="sign">)</span><span class="sign">)</span> burnin <span class="sign">&lt;</span><span class="sign">-</span> x<span class="sign">$</span><span class="keyword">call</span><span class="sign">$</span>control<span class="sign">$</span>burnin
<span class="line_number">3915 </span>        <span class="keyword">if</span><span class="sign">(</span>is<span class="sign">.</span>null<span class="sign">(</span>burnin<span class="sign">)</span><span class="sign">)</span> burnin <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">dim</span><span class="sign">(</span>x<span class="sign">$</span>history<span class="sign">$</span>coefficients<span class="sign">)</span><span class="sign">[</span>2<span class="sign">]</span>
<span class="line_number">3916 </span>        <span class="keyword">if</span><span class="sign">(</span>is<span class="sign">.</span>null<span class="sign">(</span>xlab<span class="sign">)</span><span class="sign">)</span> xlab1 <span class="sign">&lt;</span><span class="sign">-</span> <span class="quote">"x"</span> <span class="keyword">else</span> xlab1 <span class="sign">&lt;</span><span class="sign">-</span> xlab
<span class="line_number">3917 </span>        <span class="keyword">if</span><span class="sign">(</span>is<span class="sign">.</span>null<span class="sign">(</span>ylab<span class="sign">)</span><span class="sign">)</span> ylab1 <span class="sign">&lt;</span><span class="sign">-</span> <span class="quote">"Posterior density"</span> <span class="keyword">else</span> ylab1 <span class="sign">&lt;</span><span class="sign">-</span> ylab
<span class="line_number">3918 </span>        coefs <span class="sign">&lt;</span><span class="sign">-</span> x<span class="sign">$</span>history<span class="sign">$</span>coefficients
<span class="line_number">3919 </span>        coefnames <span class="sign">&lt;</span><span class="sign">-</span> <span class="keyword">colnames</span><span class="sign">(</span>coefs<span class="sign">)</span>
<span class="line_number">3920 </span>        <span class="keyword">if</span><span class="sign">(</span><span class="keyword">length</span><span class="sign">(</span>coefnames<span class="sign">)</span> <span class="sign">&gt;</span> 1<span class="sign">)</span> par<span class="sign">(</span>ask <span class="sign">=</span> TRUE<span class="sign">)</span>
<span class="line_number">3921 </span>        <span class="keyword">for</span><span class="sign">(</span>i in 1<span class="sign">:</span><span class="keyword">dim</span><span class="sign">(</span>coefs<span class="sign">)</span><span class="sign">[</span>2<span class="sign">]</span><span class="sign">)</span><span class="sign">{</span>
<span class="line_number">3922 </span>            <span class="keyword">if</span><span class="sign">(</span>is<span class="sign">.</span>null<span class="sign">(</span>main<span class="sign">)</span><span class="sign">)</span> main1 <span class="sign">&lt;</span><span class="sign">-</span> paste<span class="sign">(</span><span class="quote">"Coefficient of"</span><span class="sign">,</span> coefnames<span class="sign">[</span>i<span class="sign">]</span><span class="sign">)</span> <span class="keyword">else</span> main1 <span class="sign">&lt;</span><span class="sign">-</span> main
<span class="line_number">3923 </span>            betai <span class="sign">&lt;</span><span class="sign">-</span> coefs<span class="sign">[</span>burnin<span class="sign">:</span><span class="sign">(</span><span class="keyword">dim</span><span class="sign">(</span>coefs<span class="sign">)</span><span class="sign">[</span>1<span class="sign">]</span><span class="sign">)</span><span class="sign">,</span> i<span class="sign">]</span>
<span class="line_number">3924 </span>            plot<span class="sign">(</span>density<span class="sign">(</span>betai<span class="sign">)</span><span class="sign">,</span> lty <span class="sign">=</span> lty<span class="sign">,</span> col <span class="sign">=</span> col<span class="sign">,</span> lwd <span class="sign">=</span> lwd<span class="sign">,</span> main <span class="sign">=</span> main1<span class="sign">,</span> xlab <span class="sign">=</span> xlab1<span class="sign">,</span> ylab <span class="sign">=</span> ylab1<span class="sign">,</span> xlim <span class="sign">=</span> xlim<span class="sign">,</span> ylim <span class="sign">=</span> ylim<span class="sign">,</span> <span class="sign">.</span><span class="sign">.</span><span class="sign">.</span><span class="sign">)</span>
<span class="line_number">3925 </span>        <span class="sign">}</span>     
<span class="line_number">3926 </span>    <span class="sign">}</span>
<span class="line_number">3927 </span>    par<span class="sign">(</span>ask <span class="sign">=</span> oldask<span class="sign">)</span>
<span class="line_number">3928 </span><span class="sign">}</span>
</pre>

</div> <!-- content -->
<div id="footer">
<p>Generated from ./splinesurv/R/splinefrailty.r with <a href="http://www.xs4all.nl/~rfsber/Robo/robodoc.html">ROBODoc</a> V4.99.36 on Wed Jul 16 2008 11:21:32
</p>
</div> <!-- footer -->

<!-- Start of StatCounter Code -->
<script type="text/javascript">
var sc_project=3825578; 
var sc_invisible=1; 
var sc_partition=34; 
var sc_click_stat=1; 
var sc_security="6730661a"; 
</script>

<script type="text/javascript" src="http://www.statcounter.com/counter/counter_xhtml.js"></script><noscript><div class="statcounter"><a href="http://www.statcounter.com/" target="_blank"><img class="statcounter" src="http://c.statcounter.com/3825578/0/6730661a/1/" alt="free hit counter script" ></a></div></noscript>
<!-- End of StatCounter Code -->
</body>

</html>
